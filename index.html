<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dead Pixel</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<style>
html,body{margin:0;padding:0;overflow:hidden;background:black;}
canvas{display:block;}

button,input{
 position:absolute;
 z-index:5;
 padding:10px 18px;
 font-size:16px;
 border-radius:8px;
 border:none;
 cursor:pointer;
}
#playBtn{top:40%;left:50%;transform:translateX(-50%);background:red;color:white;}
#retryBtn,#shopBtn,#cheatBtn{display:none;left:50%;transform:translateX(-50%)}
#shopBtn{background:blue;color:white}
#cheatBtn{background:green;color:white}

#difficulty{
 top:10px;
 right:10px;
 width:120px;
}

#joystick{
 position:absolute;
 bottom:30px;
 left:30px;
 width:120px;
 height:120px;
 border-radius:50%;
 background:rgba(255,255,255,.1);
 touch-action:none;
}
#stick{
 width:50px;height:50px;
 border-radius:50%;
 background:white;
 position:absolute;
 left:35px;top:35px;
}

</style>
</head>
<body>

<canvas id="c"></canvas>

<button id="playBtn">Play</button>
<button id="retryBtn">Retry</button>
<button id="shopBtn">Shop</button>
<button id="cheatBtn">Cheat</button>

<input type="range" min="1" max="3" step="0.1" value="1" id="difficulty">

<div id="joystick">
  <div id="stick"></div>
</div>

<script>
/* ---------- CANVAS ---------- */
const c=document.getElementById("c"),ctx=c.getContext("2d");
let w=c.width=innerWidth,h=c.height=innerHeight;

/* ---------- UI ---------- */
const playBtn=playBtnEl=document.getElementById("playBtn");
const retryBtn=document.getElementById("retryBtn");
const shopBtn=document.getElementById("shopBtn");
const cheatBtn=document.getElementById("cheatBtn");
const difficulty=document.getElementById("difficulty");

/* ---------- PLAYER ---------- */
const player={
 x:w/2,y:h/2,size:12,
 speed:1,color:"red",
 rainbow:false,
 isBurger:false
};

/* ---------- BURGER IMAGE ---------- */
const burgerImg=new Image();
burgerImg.src="burger.png";

/* ---------- GAME ---------- */
let pixels=[],score=0,gameOver=false,gameRunning=false;
let usedCodes=JSON.parse(localStorage.getItem("dp_codes")||"[]");

/* ---------- SOUND ---------- */
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
function beep(freq=400){
 const o=audioCtx.createOscillator();
 const g=audioCtx.createGain();
 o.connect(g);g.connect(audioCtx.destination);
 o.frequency.value=freq;
 o.start();g.gain.exponentialRampToValueAtTime(.001,audioCtx.currentTime+.3);
}

/* ---------- SPAWN ---------- */
function spawn(type="red"){
 let p={x:Math.random()*w,y:Math.random()*h,type};
 if(type==="red"){p.size=10;p.speed=1;p.color="red";}
 if(type==="blue"){p.size=14;p.speed=1.2;p.color="blue";}
 if(type==="white"){p.size=18;p.speed=0.7;p.color="white";}
 if(type==="rainbow"){p.size=12;p.speed=0;p.color="rainbow";}
 pixels.push(p);
}

/* ---------- UPDATE ---------- */
function update(){
 let diff=+difficulty.value;
 pixels.forEach((p,i)=>{
  if(p.type==="rainbow"){
    if(dist(p,player)<15){
      player.rainbow=true;
      beep(800);
      pixels.splice(i,1);
    }
    return;
  }

  let dx=player.x-p.x,dy=player.y-p.y;
  let d=Math.hypot(dx,dy);
  p.x+=dx/d*p.speed*diff;
  p.y+=dy/d*p.speed*diff;

  if(d<player.size+p.size){
    if(player.rainbow){
      beep(600);
      score+= p.type==="red"?1:p.type==="blue"?5:10;
      pixels.splice(i,1);
    }else{
      gameOver=true;
      beep(200);
    }
  }
 });
}

/* ---------- DRAW ---------- */
function draw(){
 ctx.fillStyle="rgba(0,0,0,.3)";
 ctx.fillRect(0,0,w,h);

 pixels.forEach(p=>{
  ctx.fillStyle=p.color;
  ctx.fillRect(p.x-p.size/2,p.y-p.size/2,p.size,p.size);
 });

 if(player.isBurger){
  ctx.drawImage(burgerImg,player.x-20,player.y-20,40,40);
 }else{
  ctx.fillStyle=player.color;
  ctx.fillRect(player.x-6,player.y-6,12,12);
 }

 ctx.fillStyle="white";
 ctx.fillText("Score: "+score,10,20);

 if(gameOver){
  retryBtn.style.display=shopBtn.style.display=cheatBtn.style.display="block";
  retryBtn.style.top=h/2+40+"px";
  shopBtn.style.top=h/2+90+"px";
  cheatBtn.style.top=h/2+140+"px";
 }
}

/* ---------- LOOP ---------- */
function loop(){
 if(!gameRunning)return;
 update();draw();
 if(!gameOver)requestAnimationFrame(loop);
}

/* ---------- CONTROLS ---------- */
c.onmousemove=e=>{player.x=e.clientX;player.y=e.clientY;}

/* ---------- JOYSTICK ---------- */
const joy=document.getElementById("joystick");
const stick=document.getElementById("stick");
let joyActive=false;

joy.addEventListener("touchstart",()=>joyActive=true);
joy.addEventListener("touchend",()=>{joyActive=false;stick.style.left="35px";stick.style.top="35px";});
joy.addEventListener("touchmove",e=>{
 if(!joyActive)return;
 let r=joy.getBoundingClientRect();
 let x=e.touches[0].clientX-r.left-60;
 let y=e.touches[0].clientY-r.top-60;
 let d=Math.min(40,Math.hypot(x,y));
 let a=Math.atan2(y,x);
 let dx=Math.cos(a)*d,dy=Math.sin(a)*d;
 stick.style.left=35+dx+"px";
 stick.style.top=35+dy+"px";
 player.x+=dx*0.3;
 player.y+=dy*0.3;
});

/* ---------- BUTTONS ---------- */
playBtn.onclick=()=>{
 gameRunning=true;
 playBtn.style.display="none";
 spawn("red");
 setInterval(()=>spawn("red"),3000);
 setInterval(()=>score>=50&&spawn("blue"),5000);
 setInterval(()=>score>=100&&spawn("white"),8000);
 setInterval(()=>Math.random()<.02&&spawn("rainbow"),1000);
 setInterval(()=>!gameOver&&score++,1000);
 loop();
};

retryBtn.onclick=()=>location.reload();

cheatBtn.onclick=()=>{
 let code=prompt("Enter code:");
 if(!code)return;
 code=code.toUpperCase();
 if(usedCodes.includes(code))return alert("Code already used");

 if(code==="HUNGRY"){
  player.isBurger=true;
  usedCodes.push(code);
  localStorage.setItem("dp_codes",JSON.stringify(usedCodes));
  alert("ðŸ” You are now a hamburger!");
 }else alert("Invalid code");
};

function dist(a,b){return Math.hypot(a.x-b.x,a.y-b.y);}
onresize=()=>{w=c.width=innerWidth;h=c.height=innerHeight;}
</script>
</body>
</html>
