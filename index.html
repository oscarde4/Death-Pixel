<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dead Pixel</title>
<style>
body,html{margin:0;padding:0;overflow:hidden;background:black;}
canvas{display:block;background:black;}
button{
  position:absolute;
  padding:10px 20px;
  font-size:18px;
  background:red;
  color:white;
  border:none;
  border-radius:8px;
  cursor:pointer;
  z-index:2;
}
#playBtn{top:40%;left:50%;transform:translateX(-50%)}
#retryBtn,#shopBtn,#cheatBtn{
  display:none;
  left:50%;
  transform:translateX(-50%)
}
#shopBtn{background:blue;}
#cheatBtn{background:green;}
#shopOverlay{
  display:none;
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.85);
  color:white;
  z-index:3;
  overflow-y:auto;
  text-align:center;
}
.skinBtn{
  display:block;
  margin:15px auto;
  padding:12px;
  width:220px;
  background:#222;
  color:white;
  border:none;
  border-radius:8px;
  font-size:18px;
}
</style>
</head>
<body>

<canvas id="c"></canvas>
<button id="playBtn">Play</button>
<button id="retryBtn">Retry</button>
<button id="shopBtn">Shop</button>
<button id="cheatBtn">Cheat</button>

<div id="shopOverlay">
  <h2>Shop</h2>
  <div id="shopContainer"></div>
  <p>Points: <span id="pointsDisplay">0</span></p>
  <button id="closeShop" class="skinBtn">Close</button>
</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const playBtn = document.getElementById("playBtn");
const retryBtn = document.getElementById("retryBtn");
const shopBtn = document.getElementById("shopBtn");
const cheatBtn = document.getElementById("cheatBtn");
const shopOverlay = document.getElementById("shopOverlay");
const shopContainer = document.getElementById("shopContainer");
const pointsDisplay = document.getElementById("pointsDisplay");
const closeShop = document.getElementById("closeShop");

canvas.width = innerWidth;
canvas.height = innerHeight;

let gameRunning=false, gameOver=false;
let score=0, totalPoints=0;
let pixels=[];
let usedCheatCodes = JSON.parse(localStorage.getItem("usedCheatCodes")||"[]");

let player={x:innerWidth/2,y:innerHeight/2,size:10,color:"red",rainbow:false,rainbowTimer:0};
let isBurger=false;

// burger image
const burgerImg = new Image();
burgerImg.src = "burger.png";

// skins
let skins=[
  {name:"Red",color:"red",cost:0},
  {name:"Blue",color:"blue",cost:50},
  {name:"Green",color:"green",cost:50},
  {name:"Purple",color:"purple",cost:100},
  {name:"Cyan",color:"cyan",cost:150},
  {name:"Yellow",color:"yellow",cost:200},
  {name:"White",color:"white",cost:300},
  {name:"Black",color:"black",cost:500}
];
let ownedSkins=JSON.parse(localStorage.getItem("ownedSkins")||'["Red"]');
let selectedSkin=localStorage.getItem("selectedSkin")||"Red";

function save(){
  localStorage.setItem("points",totalPoints);
  localStorage.setItem("ownedSkins",JSON.stringify(ownedSkins));
  localStorage.setItem("selectedSkin",selectedSkin);
  localStorage.setItem("usedCheatCodes",JSON.stringify(usedCheatCodes));
}

totalPoints=parseInt(localStorage.getItem("points")||0);
pointsDisplay.textContent=totalPoints;

// spawn
function spawnPixel(type="red"){
  pixels.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    size:type==="blue"?18:type==="white"?26:10,
    speed:type==="blue"?1.2:type==="white"?0:1,
    type,
    shootTimer:Date.now()
  });
}

// draw
function draw(){
  ctx.fillStyle="rgba(0,0,0,0.25)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  pixels.forEach(p=>{
    ctx.fillStyle=p.type;
    ctx.fillRect(p.x-p.size/2,p.y-p.size/2,p.size,p.size);
  });

  if(isBurger){
    ctx.drawImage(burgerImg,player.x-20,player.y-20,40,40);
  }else{
    ctx.fillStyle=selectedSkin.toLowerCase();
    ctx.fillRect(player.x-5,player.y-5,10,10);
  }

  ctx.fillStyle="white";
  ctx.font="20px Arial";
  ctx.fillText("Score: "+score,10,30);

  if(gameOver){
    ctx.fillText("GAME OVER",canvas.width/2-70,canvas.height/2-40);
    retryBtn.style.display="block";
    shopBtn.style.display="block";
    cheatBtn.style.display="block";
    retryBtn.style.top="55%";
    shopBtn.style.top="63%";
    cheatBtn.style.top="71%";
  }
}

// update
function update(){
  if(gameOver) return;

  pixels.forEach((p,i)=>{
    let dx=player.x-p.x, dy=player.y-p.y;
    let d=Math.hypot(dx,dy);
    if(p.type!=="white"){
      p.x+=dx/d*p.speed;
      p.y+=dy/d*p.speed;
    }
    if(d<p.size){
      gameOver=true;
    }
  });

  if(Math.random()<0.02) spawnPixel("red");
  if(score>=50 && Math.random()<0.005) spawnPixel("blue");
  if(score>=100 && Math.random()<0.002) spawnPixel("white");
}

// loop
function loop(){
  if(!gameRunning) return;
  update();
  draw();
  if(!gameOver) requestAnimationFrame(loop);
}

// controls
canvas.addEventListener("mousemove",e=>{player.x=e.clientX;player.y=e.clientY});
canvas.addEventListener("touchmove",e=>{
  e.preventDefault();
  player.x=e.touches[0].clientX;
  player.y=e.touches[0].clientY;
},{passive:false});

// buttons
playBtn.onclick=()=>{
  gameRunning=true;
  playBtn.style.display="none";
  score=0; pixels=[];
  gameOver=false;
  loop();
  setInterval(()=>{if(!gameOver)score++},1000);
};

retryBtn.onclick=()=>{
  totalPoints+=score;
  save();
  location.reload();
};

cheatBtn.onclick=()=>{
  let code=prompt("Enter code");
  if(!code) return;
  code=code.toUpperCase();
  if(usedCheatCodes.includes(code)) return alert("Already used");
  if(code==="REWARDXD"){
    totalPoints+=200;
  }else if(code==="HUNGRY"){
    isBurger=true;
  }else return alert("Invalid code");
  usedCheatCodes.push(code);
  save();
  alert("Code activated!");
};

shopBtn.onclick=()=>{
  shopOverlay.style.display="block";
  shopContainer.innerHTML="";
  skins.forEach(s=>{
    let b=document.createElement("button");
    b.className="skinBtn";
    b.textContent=s.name+" ("+s.cost+")";
    b.onclick=()=>{
      if(!ownedSkins.includes(s.name)){
        if(totalPoints<s.cost) return;
        totalPoints-=s.cost;
        ownedSkins.push(s.name);
      }
      selectedSkin=s.name;
      save();
    };
    shopContainer.appendChild(b);
  });
};

closeShop.onclick=()=>shopOverlay.style.display="none";

</script>
</body>
</html>
