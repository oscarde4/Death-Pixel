<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dead Pixel</title>
<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:black;
}
canvas{display:block}
button{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  padding:12px 24px;
  font-size:18px;
  background:red;
  color:white;
  border:none;
  border-radius:10px;
  z-index:5;
}
#playBtn{top:40%}
#retryBtn,#shopBtn,#cheatBtn{display:none}
#shopBtn{background:blue}
#cheatBtn{background:green}
</style>
</head>
<body>

<canvas id="game"></canvas>

<button id="playBtn">Play</button>
<button id="retryBtn">Retry</button>
<button id="shopBtn">Shop</button>
<button id="cheatBtn">Cheat</button>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

const playBtn=document.getElementById("playBtn");
const retryBtn=document.getElementById("retryBtn");
const shopBtn=document.getElementById("shopBtn");
const cheatBtn=document.getElementById("cheatBtn");

// ---------------- GAME STATE ----------------
let gameRunning=false;
let gameOver=false;
let score=0;
let pixels=[];

// ---------------- PLAYER ----------------
let player={
  x:canvas.width/2,
  y:canvas.height/2,
  size:10,
  color:"red"
};

// ---------------- BURGER CHEAT ----------------
let usedCheatCodes=JSON.parse(localStorage.getItem("usedCheatCodes")||"[]");
let isBurger=false;
const burgerImg=new Image();
burgerImg.src="burger.png";

// ---------------- SPAWN ----------------
function spawnPixel(type="red"){
  pixels.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    size:type==="blue"?18:type==="white"?26:10,
    speed:type==="blue"?1.2:type==="white"?0:1,
    type
  });
}

// ---------------- DRAW ----------------
function draw(){
  ctx.fillStyle="rgba(0,0,0,0.3)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // enemies
  pixels.forEach(p=>{
    ctx.fillStyle=p.type;
    ctx.fillRect(p.x-p.size/2,p.y-p.size/2,p.size,p.size);
  });

  // player
  if(isBurger){
    ctx.drawImage(burgerImg,player.x-20,player.y-20,40,40);
  }else{
    ctx.fillStyle=player.color;
    ctx.fillRect(player.x-5,player.y-5,10,10);
  }

  ctx.fillStyle="white";
  ctx.font="20px Arial";
  ctx.fillText("Score: "+score,10,30);

  if(gameOver){
    ctx.fillText("GAME OVER",canvas.width/2-70,canvas.height/2-40);
    retryBtn.style.display="block";
    shopBtn.style.display="block";
    cheatBtn.style.display="block";
    retryBtn.style.top="55%";
    shopBtn.style.top="63%";
    cheatBtn.style.top="71%";
  }
}

// ---------------- UPDATE ----------------
function update(){
  if(gameOver) return;

  pixels.forEach((p,i)=>{
    if(p.type!=="white"){
      let dx=player.x-p.x;
      let dy=player.y-p.y;
      let d=Math.hypot(dx,dy);
      p.x+=dx/d*p.speed;
      p.y+=dy/d*p.speed;
      if(d<p.size) gameOver=true;
    }
  });

  // spawns (normal speed)
  if(Math.random()<0.02) spawnPixel("red");
  if(score>=50 && Math.random()<0.004) spawnPixel("blue");
  if(score>=100 && Math.random()<0.002) spawnPixel("white");
}

// ---------------- LOOP ----------------
function loop(){
  if(!gameRunning) return;
  update();
  draw();
  if(!gameOver) requestAnimationFrame(loop);
}

// ---------------- TOUCH CONTROL (ONLY) ----------------
canvas.addEventListener("touchmove",e=>{
  e.preventDefault();
  const t=e.touches[0];
  player.x=t.clientX;
  player.y=t.clientY;
},{passive:false});

// ---------------- BUTTONS ----------------
playBtn.onclick=()=>{
  gameRunning=true;
  gameOver=false;
  score=0;
  pixels=[];
  playBtn.style.display="none";
  loop();
  setInterval(()=>{if(!gameOver)score++},1000);
};

retryBtn.onclick=()=>location.reload();

cheatBtn.onclick=()=>{
  let code=prompt("Enter cheat code:");
  if(!code) return;
  code=code.toUpperCase();

  if(usedCheatCodes.includes(code)){
    alert("Code already used");
    return;
  }

  if(code==="HUNGRY"){
    isBurger=true;
  }else{
    alert("Invalid code");
    return;
  }

  usedCheatCodes.push(code);
  localStorage.setItem("usedCheatCodes",JSON.stringify(usedCheatCodes));
  alert("Cheat activated!");
};

</script>
</body>
</html>
