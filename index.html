<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dead Pixel</title>
<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:black;
}
canvas{display:block}
button{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  padding:12px 24px;
  font-size:18px;
  border:none;
  border-radius:10px;
  cursor:pointer;
  z-index:5;
  color:white;
}
#playBtn{top:40%;background:red}
#retryBtn,#shopBtn,#cheatBtn{display:none}
#retryBtn{background:red}
#shopBtn{background:blue}
#cheatBtn{background:green}

/* SHOP */
#shopOverlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.9);
  z-index:10;
  display:none;
  color:white;
  text-align:center;
}
#shopList{
  max-height:70vh;
  overflow-y:auto;
}
.skinBtn{
  display:block;
  margin:12px auto;
  padding:12px;
  width:220px;
  font-size:18px;
  background:#222;
  color:white;
  border:none;
  border-radius:8px;
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<button id="playBtn">Play</button>
<button id="retryBtn">Retry</button>
<button id="shopBtn">Shop</button>
<button id="cheatBtn">Cheat</button>

<div id="shopOverlay">
  <h2>Shop</h2>
  <p>Points: <span id="pointsText">0</span></p>
  <div id="shopList"></div>
  <button class="skinBtn" id="closeShop">Close</button>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

const playBtn=document.getElementById("playBtn");
const retryBtn=document.getElementById("retryBtn");
const shopBtn=document.getElementById("shopBtn");
const cheatBtn=document.getElementById("cheatBtn");

const shopOverlay=document.getElementById("shopOverlay");
const shopList=document.getElementById("shopList");
const pointsText=document.getElementById("pointsText");
const closeShop=document.getElementById("closeShop");

// ---------------- STATE ----------------
let gameRunning=false;
let gameOver=false;
let score=0;
let totalPoints=parseInt(localStorage.getItem("points")||0);
pointsText.textContent=totalPoints;

let pixels=[];

// ---------------- PLAYER ----------------
let player={x:canvas.width/2,y:canvas.height/2,size:10,color:"red"};

// ---------------- CHEATS ----------------
let usedCheatCodes=JSON.parse(localStorage.getItem("usedCheatCodes")||"[]");
let isBurger=false;
const burgerImg=new Image();
burgerImg.src="burger.png";

// ---------------- SKINS ----------------
const skins=[
  {name:"Red",color:"red",cost:0},
  {name:"Blue",color:"blue",cost:50},
  {name:"Green",color:"green",cost:75},
  {name:"Purple",color:"purple",cost:100},
  {name:"Cyan",color:"cyan",cost:150},
  {name:"Yellow",color:"yellow",cost:200},
  {name:"White",color:"white",cost:300},
  {name:"Black",color:"black",cost:500}
];

let ownedSkins=JSON.parse(localStorage.getItem("ownedSkins")||'["Red"]');
let selectedSkin=localStorage.getItem("selectedSkin")||"Red";

// ---------------- SAVE ----------------
function save(){
  localStorage.setItem("points",totalPoints);
  localStorage.setItem("ownedSkins",JSON.stringify(ownedSkins));
  localStorage.setItem("selectedSkin",selectedSkin);
  localStorage.setItem("usedCheatCodes",JSON.stringify(usedCheatCodes));
}

// ---------------- SPAWN ----------------
function spawnPixel(type="red"){
  pixels.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    size:type==="blue"?18:type==="white"?26:10,
    speed:type==="blue"?1.2:type==="white"?0:1,
    type
  });
}

// ---------------- DRAW ----------------
function draw(){
  ctx.fillStyle="rgba(0,0,0,0.25)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  pixels.forEach(p=>{
    ctx.fillStyle=p.type;
    ctx.fillRect(p.x-p.size/2,p.y-p.size/2,p.size,p.size);
  });

  if(isBurger){
    ctx.drawImage(burgerImg,player.x-20,player.y-20,40,40);
  }else{
    ctx.fillStyle=selectedSkin.toLowerCase();
    ctx.fillRect(player.x-5,player.y-5,10,10);
  }

  ctx.fillStyle="white";
  ctx.font="20px Arial";
  ctx.fillText("Score: "+score,10,30);

  if(gameOver){
    retryBtn.style.display="block";
    shopBtn.style.display="block";
    cheatBtn.style.display="block";
    retryBtn.style.top="55%";
    shopBtn.style.top="63%";
    cheatBtn.style.top="71%";
  }
}

// ---------------- UPDATE ----------------
function update(){
  if(gameOver) return;

  pixels.forEach(p=>{
    let dx=player.x-p.x;
    let dy=player.y-p.y;
    let d=Math.hypot(dx,dy);
    if(p.type!=="white"){
      p.x+=dx/d*p.speed;
      p.y+=dy/d*p.speed;
    }
    if(d<p.size) gameOver=true;
  });

  if(Math.random()<0.02) spawnPixel("red");
  if(score>=50 && Math.random()<0.004) spawnPixel("blue");
  if(score>=100 && Math.random()<0.002) spawnPixel("white");
}

// ---------------- LOOP ----------------
function loop(){
  if(!gameRunning) return;
  update();
  draw();
  if(!gameOver) requestAnimationFrame(loop);
}

// ---------------- TOUCH ----------------
canvas.addEventListener("touchmove",e=>{
  e.preventDefault();
  player.x=e.touches[0].clientX;
  player.y=e.touches[0].clientY;
},{passive:false});

// ---------------- BUTTONS ----------------
playBtn.onclick=()=>{
  gameRunning=true;
  gameOver=false;
  score=0;
  pixels=[];
  playBtn.style.display="none";
  loop();
  setInterval(()=>{if(!gameOver)score++},1000);
};

retryBtn.onclick=()=>{
  totalPoints+=score;
  save();
  location.reload();
};

// ---- CHEAT (LIMITED PER CODE) ----
cheatBtn.onclick=()=>{
  let code=prompt("Enter cheat code:");
  if(!code) return;
  code=code.toUpperCase();

  if(usedCheatCodes.includes(code)){
    alert("This code was already used!");
    return;
  }

  if(code==="HUNGRY"){
    isBurger=true;
  }else{
    alert("Invalid code");
    return;
  }

  usedCheatCodes.push(code);
  save();
  alert("Cheat activated!");
};

// ---------------- SHOP ----------------
shopBtn.onclick=()=>{
  shopOverlay.style.display="block";
  shopList.innerHTML="";
  pointsText.textContent=totalPoints;

  skins.forEach(s=>{
    let btn=document.createElement("button");
    btn.className="skinBtn";
    let owned=ownedSkins.includes(s.name);
    btn.textContent=owned ? `${s.name} (Owned)` : `${s.name} - ${s.cost} pts`;

    btn.onclick=()=>{
      if(!owned){
        if(totalPoints<s.cost) return;
        totalPoints-=s.cost;
        ownedSkins.push(s.name);
      }
      selectedSkin=s.name;
      save();
      shopBtn.onclick();
    };

    shopList.appendChild(btn);
  });
};

closeShop.onclick=()=>shopOverlay.style.display="none";
</script>
</body>
</html>
