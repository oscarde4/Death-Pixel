<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dead Pixel Rainbow Game with Shooter</title>
<style>
  body, html {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background-color: black;
    font-family: Arial, sans-serif;
  }
  canvas {
    display: block;
    background-color: black;
  }
  #playBtn, #retryBtn {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    padding: 15px 30px;
    font-size: 20px;
    background-color: red;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    z-index: 1;
  }
  #playBtn { top: 50%; }
  #retryBtn { top: 65%; display: none; }
</style>
</head>
<body>

<canvas id="game"></canvas>
<button id="playBtn">Play</button>
<button id="retryBtn">Play Again</button>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const playBtn = document.getElementById('playBtn');
const retryBtn = document.getElementById('retryBtn');

let width = window.innerWidth;
let height = window.innerHeight;
canvas.width = width;
canvas.height = height;

let score = 0;
let pixels = [];
let arrows = []; // projectiles from white dough
let player = { x: width/2, y: height/2, size: 10, rainbow: false, rainbowTimer: 0 };
let gameOver = false;
let gameRunning = false;
let spawnInterval = 2000;
let baseSpeed = 1.5;
let strongerPixelsUnlocked = false;
let whiteShooterUnlocked = false;

// -------------------- SPAWN PIXELS --------------------
function spawnPixel(strong=false, whiteShooter=false) {
  if(!gameRunning) return;
  let x = Math.random()*width;
  let y = Math.random()*height;
  let pixel = {
    x:x,
    y:y,
    size: strong ? 20 : 10,
    speed: (baseSpeed + score*0.05)*(strong ? 1.2 : 1),
    color: strong ? 'blue' : 'red',
    strong: strong || false,
    whiteShooter: whiteShooter || false,
    shootTimer: Date.now()
  };
  if(whiteShooter) pixel.size = 30; // bigger than blue
  pixels.push(pixel);
}

// -------------------- SPAWN RAINBOW PIXEL --------------------
function spawnRainbowPixel() {
  if(!gameRunning) return;
  let x = Math.random()*width;
  let y = Math.random()*height;
  pixels.push({
    x:x,
    y:y,
    size: 12,
    speed: 0,
    color: 'rainbow',
    rainbow: true
  });
}

// -------------------- RESET --------------------
function resetGame() {
  score = 0;
  pixels = [];
  arrows = [];
  player.x = width/2;
  player.y = height/2;
  player.rainbow = false;
  player.rainbowTimer = 0;
  gameOver = false;
  strongerPixelsUnlocked = false;
  whiteShooterUnlocked = false;
  retryBtn.style.display='none';
  loop();
  setTimeout(()=>{ spawnPixel(); },2000);
}

// -------------------- DRAW --------------------
function draw() {
  ctx.fillStyle = 'rgba(0,0,0,0.2)';
  ctx.fillRect(0,0,width,height);

  // Draw pixels
  pixels.forEach(p=>{
    if(p.rainbow){
      let gradient = ctx.createLinearGradient(p.x-6,p.y-6,p.x+6,p.y+6);
      gradient.addColorStop(0,'red');
      gradient.addColorStop(0.2,'orange');
      gradient.addColorStop(0.4,'yellow');
      gradient.addColorStop(0.6,'green');
      gradient.addColorStop(0.8,'blue');
      gradient.addColorStop(1,'purple');
      ctx.fillStyle = gradient;
    } else if(p.whiteShooter) {
      ctx.fillStyle = 'white';
    } else {
      ctx.fillStyle = p.color;
    }
    ctx.fillRect(p.x-p.size/2,p.y-p.size/2,p.size,p.size);
  });

  // Draw arrows
  arrows.forEach(a=>{
    ctx.fillStyle='white';
    ctx.fillRect(a.x-a.size/2, a.y-a.size/2, a.size, a.size);
  });

  // Draw player
  if(player.rainbow){
    let gradient = ctx.createLinearGradient(player.x-player.size/2,player.y-player.size/2,
                                            player.x+player.size/2,player.y+player.size/2);
    gradient.addColorStop(0,'red');
    gradient.addColorStop(0.2,'orange');
    gradient.addColorStop(0.4,'yellow');
    gradient.addColorStop(0.6,'green');
    gradient.addColorStop(0.8,'blue');
    gradient.addColorStop(1,'purple');
    ctx.fillStyle = gradient;
  } else ctx.fillStyle='red';
  ctx.fillRect(player.x-player.size/2,player.y-player.size/2,player.size,player.size);

  // Score
  ctx.fillStyle = 'white';
  ctx.font='20px Arial';
  ctx.fillText('Score: '+score,10,30);

  // Game over
  if(gameOver){
    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.fillRect(width/2 -180,height/2-80,360,120);
    ctx.fillStyle='white';
    ctx.font='50px Arial';
    ctx.textAlign='center';
    ctx.fillText('GAME OVER',width/2,height/2-20);
    ctx.font='30px Arial';
    ctx.fillText('Final Score: '+score,width/2,height/2+30);
    retryBtn.style.display='block';
  }
}

// -------------------- UPDATE --------------------
function update() {
  if(gameOver) return;

  pixels.forEach((p,i)=>{
    if(p.rainbow) {
      let dx = player.x - p.x;
      let dy = player.y - p.y;
      let dist = Math.sqrt(dx*dx + dy*dy);
      if(dist < (p.size/2 + player.size/2)){
        player.rainbow = true;
        player.rainbowTimer = Date.now();
        pixels.splice(i,1);
      }
      return;
    }

    // white shooter shooting arrows
    if(p.whiteShooter){
      if(Date.now() - p.shootTimer > 1500){ // shoot every 1.5s
        let dx = player.x - p.x;
        let dy = player.y - p.y;
        let dist = Math.sqrt(dx*dx + dy*dy);
        arrows.push({
          x: p.x,
          y: p.y,
          vx: dx/dist*5,
          vy: dy/dist*5,
          size:6
        });
        p.shootTimer = Date.now();
      }
      return; // white shooter does not move
    }

    // red and blue move
    let dx = player.x - p.x;
    let dy = player.y - p.y;
    let dist = Math.sqrt(dx*dx + dy*dy);
    let speed = p.speed;
    p.x += dx/dist*speed;
    p.y += dy/dist*speed;

    if(dist < (p.size/2 + player.size/2)){
      if(player.rainbow && !p.strong) pixels.splice(i,1);
      else if(p.strong) gameOver=true;
      else gameOver=true;
    }
  });

  // Update arrows
  arrows.forEach((a,ai)=>{
    a.x += a.vx;
    a.y += a.vy;
    let dx = player.x - a.x;
    let dy = player.y - a.y;
    let dist = Math.sqrt(dx*dx + dy*dy);
    if(dist < player.size/2){
      if(!player.rainbow) gameOver=true;
      arrows.splice(ai,1);
    }
    // remove arrow if out of screen
    if(a.x<0 || a.x>width || a.y<0 || a.y>height) arrows.splice(ai,1);
  });

  if(player.rainbow && Date.now() - player.rainbowTimer > 25000){
    player.rainbow=false;
  }

  if(score>=50 && !strongerPixelsUnlocked){
    strongerPixelsUnlocked=true;
    for(let i=0;i<2;i++) spawnPixel(true);
  }

  // white shooter spawn
  if(score>=100 && !whiteShooterUnlocked){
    whiteShooterUnlocked=true;
    spawnPixel(false,true);
  }
  if(whiteShooterUnlocked && Math.random()<0.002){
    spawnPixel(false,true); // rare random spawns
  }
}

// -------------------- LOOP --------------------
function loop(){
  if(!gameRunning) return;
  update();
  draw();
  if(!gameOver) requestAnimationFrame(loop);
}

// -------------------- TOUCH CONTROL --------------------
canvas.addEventListener('touchmove', function(e){
  e.preventDefault();
  let touch = e.touches[0];
  player.x = touch.clientX;
  player.y = touch.clientY;
}, {passive:false});

// -------------------- SPAWN & SCORE --------------------
let pixelSpawner, rainbowSpawner, scoreInterval;

function startGame(){
  gameRunning=true;
  playBtn.style.display='none';
  resetGame();
  pixelSpawner=setInterval(()=>{ spawnPixel(); },2000);
  rainbowSpawner=setInterval(()=>{ if(Math.random()<0.01) spawnRainbowPixel(); },1000);
  scoreInterval=setInterval(()=>{ if(!gameOver) score++; },1000);
}

// Retry button
retryBtn.addEventListener('click',()=>{
  clearInterval(pixelSpawner);
  clearInterval(rainbowSpawner);
  clearInterval(scoreInterval);
  startGame();
});

// Play button
playBtn.addEventListener('click', startGame);

// Resize
window.addEventListener('resize',()=>{
  width = window.innerWidth;
  height = window.innerHeight;
  canvas.width = width;
  canvas.height = height;
});
</script>
</body>
</html>